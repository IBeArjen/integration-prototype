input {
    redis {
        host      => redis
        data_type => list
        key       => logstash
        codec     => json
    }
    udp {
        port  => 5000
        codec => json
    }
}

filter {
    if [docker][image] =~ /logstash/ {
        drop { }
    }
    if [docker][image] =~ /kibana-logtrail/ {
        drop { }
    }
    if [docker][image] =~ /kibana/ {
        json {
            source => message
            target => kibana
        }
        date {
            match => ['[kibana][@timestamp]', 'ISO8601']
        }
        mutate {
            rename => ['[kibana][message]', 'message']
            remove => ['[kibana][@timestamp]']
        }
    }
    if [docker][image] =~ /elasticsearch/ {
        drop { }
    }
}

output {
    elasticsearch {
        hosts => elasticsearch
    }
    stdout {
        codec => rubydebug
    }
}
